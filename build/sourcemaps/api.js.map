{"version":3,"sources":["api.js"],"names":[],"mappings":";;;;;;;;AAMA,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACvB,IAAI,YAAY,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;AAC3C,IAAI,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;;AAEjC,IAAI,YAAY,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;;AAE7C,IAAI,IAAI,GAAG,UAAU,CAAC;AACtB,IAAI,IAAI,GAAG,EAAE,CAAC;;AAEd,SAAS,QAAQ,CAAC,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE;AACpC,MAAI,GAAG,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;AAC7B,KAAG,CAAC,IAAI,GAAG,IAAI,CAAC;AAChB,KAAG,CAAC,GAAG,GAAG,GAAG,CAAC;AACd,KAAG,CAAC,WAAW,GAAG,IAAI,CAAC;AACvB,SAAO,GAAG,CAAC;CACZ;;AAED,IAAI,eAAe,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa;;;aAE7B,MAAM,YAAY,CAAC,aAAa,EAAE;;MAAzC,GAAG,QAAH,GAAG;;AACR,MAAI,IAAI,GAAG,AAAC,GAAG,IAAI,GAAG,CAAC,IAAI,IAAK,IAAI,CAAC;AACrC,MAAI,IAAI,GAAG,AAAC,GAAG,IAAI,GAAG,CAAC,IAAI,IAAK,IAAI,CAAC;AACrC,MAAI,OAAO,GAAG,AAAC,GAAG,IAAI,GAAG,CAAC,OAAO,IAAM,SAAS,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,SAAS,AAAC,CAAC;AAClF,SAAO,OAAO,CAAC;CAChB,CAAC,CAAC;;AAEH,IAAI,eAAe,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,UAAU,EAAE,IAAI,EAAE;;AAEzD,MAAI,OAAO,GAAG,MAAM,eAAe,EAAE,CAAC;AACtC,MAAI,GAAG,GAAG,OAAO,GAAG,GAAG,GAAG,kBAAkB,CAAC,UAAU,CAAC,GAAG,GAAG,GAAG,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;;AAE1G,MAAI,QAAQ,GAAG,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAC/C,MAAI,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;AACzB,MAAI;AACF,QAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;GACjC,CAAC,OAAO,CAAC,EAAE;AACV,QAAI,GAAG,GAAG,IAAI,KAAK,CAAC,wCAAwC,GAAG,IAAI,CAAC,CAAC;AACrE,UAAM,GAAG,CAAC;GACX;AACD,MAAI,QAAQ,CAAC,GAAG,EAAE;AAChB,UAAM,QAAQ,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC;GAC/D;AACD,SAAO,QAAQ,CAAC;CACjB,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,GAAG;AACf,iBAAe,EAAf,eAAe;AACf,iBAAe,EAAf,eAAe,EAChB,CAAC","file":"api.js","sourcesContent":["/*eU\n\n * Makes an API call to exp.host\n *\n */\n\nvar co = require('co');\nvar instapromise = require('instapromise');\nvar request = require('request');\n\nvar userSettings = require('./userSettings');\n\nvar HOST = 'exp.host';\nvar PORT = 80;\n\nfunction ApiError(code, env, message) {\n  var err = new Error(message);\n  err.code = code;\n  err.env = env;\n  err._isApiError = true;\n  return err;\n}\n\nvar getBaseUrlAsync = co.wrap(function *() {\n  // TODO: Let you specify host and port with command line arguments (use config module)\n  var {api} = yield userSettings.readFileAsync();\n  var host = (api && api.host) || HOST;\n  var port = (api && api.port) || PORT;\n  var baseUrl = (api && api.baseUrl) || ('http://' + host + ':' + port + '/--/api');\n  return baseUrl;\n});\n\nvar callMethodAsync = co.wrap(function *(methodName, args) {\n  // TODO: Make this configurable at some point\n  var baseUrl = yield getBaseUrlAsync();\n  var url = baseUrl + '/' + encodeURIComponent(methodName) + '/' + encodeURIComponent(JSON.stringify(args));\n  //console.log(\"url=\", url);\n  var response = yield request.promise.post(url);\n  var body = response.body;\n  try {\n    var response = JSON.parse(body);\n  } catch (e) {\n    var err = new Error(\"Unparseable response from API server: \" + body);\n    throw err;\n  }\n  if (response.err) {\n    throw ApiError(response.code, response.err.env, response.err);\n  }\n  return response;\n});\n\nmodule.exports = {\n  callMethodAsync,\n  getBaseUrlAsync,\n};\n"],"sourceRoot":"/source/"}