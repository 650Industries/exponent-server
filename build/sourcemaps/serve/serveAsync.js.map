{"version":3,"sources":["serve/serveAsync.js"],"names":[],"mappings":"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","file":"serve/serveAsync.js","sourcesContent":["var crayon = require('@ccheever/crayon');\nvar delayAsync = require('delay-async');\nvar freeportAsync = require('freeport-async');\nvar instapromise = require('instapromise');\nvar network = require('@exponent/network');\nvar ngrok = require('ngrok');\n\nvar config = require('../config');\nvar PackagerController = require('./PackagerController');\nvar urlUtil = require('../urlUtil');\n\nfunction _randomPortRangeStart() {\n  return 19000 + Math.floor(Math.random() * 1000);\n}\n\nmodule.exports = async function (opts) {\n\n  var expSettings = await config.expInfoFile.readAsync();\n  opts = opts || {};\n  var port = opts.port || expSettings.port || await freeportAsync(_randomPortRangeStart());\n\n  var pc = new PackagerController({port});\n  pc.start();\n  var ngrokUrl$ = ngrok.promise.connect({port});\n\n  var [_ready, ngrokBaseUrl, lanIp, entryPoint, mainModulePath] = await Promise.all([\n    pc.packagerReady,\n    ngrokUrl$,\n    network.privateIpAsync(),\n    urlUtil.entryPointAsync(),\n    urlUtil.guessMainModulePathAsync(),\n    ]);\n  var lanBaseUrl = 'http://' + lanIp + ':' + port;\n  var localhostBaseUrl = 'http://localhost:' + port;\n\n  var urlOpts = {entryPoint, mainModulePath};\n  var lanUrl = urlUtil.constructUrlFromBaseUrl(lanBaseUrl, urlOpts);\n  var localhostUrl = urlUtil.constructUrlFromBaseUrl(localhostBaseUrl, urlOpts);\n  var ngrokUrl = urlUtil.constructUrlFromBaseUrl(ngrokBaseUrl, urlOpts);\n\n  var writeInfoFile$ = config.expInfoFile.mergeAsync({\n    port,\n    ngrokBaseUrl, lanBaseUrl, localhostBaseUrl,\n    ngrokUrl, lanUrl, localhostUrl,\n    });\n\n  var [_data, _true] = await Promise.all([writeInfoFile$, urlUtil.testUrlAsync(localhostUrl)]);\n\n  return _data;\n}\n\nif (require.main === module) {\n  module.exports().then(crayon.cyan.log, crayon.red.log);\n}\n"],"sourceRoot":"/source/"}