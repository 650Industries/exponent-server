{"version":3,"sources":["userSettings.js"],"names":[],"mappings":";;AAAA,IAAI,CAAC,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;AAC/B,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACvB,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACvB,IAAI,YAAY,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;AAC3C,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/B,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;;;AAG3B,SAAS,gBAAgB,GAAG;AAC1B,SAAO,IAAI,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,eAAe,CAAC,CAAC;CAC3D;;AAED,SAAS,oBAAoB,GAAG;AAC9B,MAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE;AACrB,UAAM,IAAI,KAAK,CAAC,yFAAwF,CAAC,CAAC;GAC3G;AACD,SAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;CACjD;;AAGD,IAAI,cAAc,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,IAAI,EAAE;AAC5C,QAAM,MAAM,CAAC,OAAO,CAAC,oBAAoB,EAAE,CAAC,CAAC;AAC7C,QAAM,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,gBAAgB,EAAE,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;AACtF,SAAO,IAAI,CAAC;CACb,CAAC,CAAC;;AAEH,IAAI,aAAa,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa;AACvC,MAAI;AACF,QAAI,IAAI,GAAG,MAAM,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,gBAAgB,EAAE,EAAE,MAAM,CAAC,CAAC;GAClE,CAAC,OAAO,CAAC,EAAE;;AAEV,WAAO,EAAE,CAAC;GACX;;AAED,MAAI;AACF,WAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;GACzB,CAAC,OAAO,CAAC,EAAE;AACV,UAAM,IAAI,KAAK,CAAC,gCAAgC,GAAG,gBAAgB,EAAE,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC;GAClF;CACF,CAAC,CAAC;;AAEH,IAAI,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,IAAI,EAAE;;AAExC,MAAI,OAAO,GAAG,MAAM,aAAa,EAAE,CAAC;AACpC,MAAI,OAAO,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;AACtC,SAAO,MAAM,cAAc,CAAC,OAAO,CAAC,CAAC;CACtC,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,GAAG;AACf,YAAU,EAAV,UAAU;AACV,eAAa,EAAb,aAAa;AACb,kBAAgB,EAAhB,gBAAgB;AAChB,gBAAc,EAAd,cAAc,EACf,CAAC","file":"userSettings.js","sourcesContent":["var _ = require('lodash-node');\nvar co = require('co');\nvar fs = require('fs');\nvar instapromise = require('instapromise');\nvar mkdirp = require('mkdirp');\nvar path = require('path');\n\n// TODO: Make this more configurable\nfunction userSettingsFile() {\n  return path.join(dotExponentDirectory(), 'exponent.json');\n}\n\nfunction dotExponentDirectory() {\n  if (!process.env.HOME) {\n    throw new Error(\"Can't determine your home directory; make sure your $HOME environment variable is set.\");\n  }\n  return path.join(process.env.HOME, '.exponent');\n}\n\n\nvar writeFileAsync = co.wrap(function *(data) {\n  yield mkdirp.promise(dotExponentDirectory());\n  yield fs.promise.writeFile(userSettingsFile(), JSON.stringify(data, null, 2), 'utf8');\n  return data;\n});\n\nvar readFileAsync = co.wrap(function *() {\n  try {\n    var json = yield fs.promise.readFile(userSettingsFile(), 'utf8');\n  } catch (e) {\n    // File not found or not readable\n    return {};\n  }\n\n  try {\n    return JSON.parse(json);\n  } catch (e) {\n    throw new Error(\"Invalid JSON in settings file \" + userSettingsFile() + \":\" + e);\n  }\n});\n\nvar mergeAsync = co.wrap(function *(data) {\n  // TODO: Make this atomic/transactional (but its probably OK to not worry about this for now)\n  var oldData = yield readFileAsync();\n  var newData = _.assign(oldData, data); // N.B.: oldData actually gets mutated here\n  return yield writeFileAsync(newData);\n});\n\nmodule.exports = {\n  mergeAsync,\n  readFileAsync,\n  userSettingsFile,\n  writeFileAsync,\n};\n"],"sourceRoot":"/source/"}