{"version":3,"sources":["urlUtil.js"],"names":[],"mappings":"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","file":"urlUtil.js","sourcesContent":["/**\n * A module for working with the URL file\n *\n */\n\nvar _ = require('lodash-node');\nvar fs = require('fs');\nvar instapromise = require('instapromise');\nvar jsonFile = require('@exponent/json-file');\nvar path = require('path');\nvar request = require('request');\n\nvar api = require('./api');\nvar config = require('./config');\n\nvar entryPointAsync = async function() {\n  // TODO: Allow configurations that point to iOS main and Android main, etc.\n  // and are checked before looking at 'main'\n  return await config.packageJsonFile.getAsync('main', 'index.js');\n}\n\nvar guessMainModulePathAsync = async function () {\n  var entryPoint = await entryPointAsync();\n  return entryPoint.replace(/\\.js$/, '');\n}\n\nfunction constructUrlFromBaseUrl(baseUrl, opts) {\n  var url = baseUrl;\n  opts = opts || {};\n  var {mainModulePath, dev, minify} = opts;\n  mainModulePath = mainModulePath || 'index.js';\n  url += '/' + encodeURIComponent(mainModulePath) + '.';\n  if (opts.includeRequire !== false) {\n    url += encodeURIComponent('includeRequire.');\n  }\n  if (opts.runModule !== false) {\n    url += encodeURIComponent('runModule.');\n  }\n  url += 'bundle';\n  url += '?dev=' + encodeURIComponent(!!dev);\n  if (minify != null) {\n    url += '&minify=' + encodeURIComponent(!!minify);\n  }\n  return url;\n}\n\nasync function constructUrlAsync(opts) {\n  if (_.isString(opts)) {\n    opts = {type: opts};\n  }\n  opts = opts || {};\n  var key = opts.type;\n  var baseUrl = await config.expInfoFile.getAsync(key + 'BaseUrl');\n  opts.mainModulePath = opts.mainModulePath || await guessMainModulePathAsync();\n  return constructUrlFromBaseUrl(baseUrl, opts);\n}\n\nasync function mainBundleUrlAsync(opts) {\n  return await constructUrlAsync(opts);\n}\n\nasync function getTestedMainBundleUrlAsync(opts) {\n  var url = await mainBundleUrlAsync(opts);\n  return await testUrlAsync(url);\n}\n\nasync function testUrlAsync(url) {\n  var response = await request.promise.get(url);\n  if (!(response.statusCode == 200)) {\n    throw new Error(\"Problem reading from URL \" + url + \"\\nstatusCode=\" + response.statusCode);\n  }\n  return url;\n}\n\nfunction expUrlFromHttpUrl(url) {\n  return ('' + url).replace(/^http(s?)/,'exp');\n}\n\nfunction sendUrlAsync(recipient, expUrl) {\n  return api.callMethodAsync('send', [recipient, expUrl]);\n}\n\nasync function httpRedirectUrlAsync(url) {\n  var baseUrl = await api.getExpHostBaseUrlAsync();\n  return baseUrl + '/--/to-exp/' + encodeURIComponent(url);\n}\n\nmodule.exports = {\n  constructUrlFromBaseUrl,\n  expUrlFromHttpUrl,\n  getTestedMainBundleUrlAsync,\n  mainBundleUrlAsync,\n  sendUrlAsync,\n  testUrlAsync,\n  entryPointAsync,\n  guessMainModulePathAsync,\n  httpRedirectUrlAsync,\n};\n"],"sourceRoot":"/source/"}