{"version":3,"sources":["urlUtil.js"],"names":[],"mappings":"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","file":"urlUtil.js","sourcesContent":["/**\n * A module for working with the URL file\n *\n */\n\nvar _ = require('lodash-node');\nvar fs = require('fs');\nvar instapromise = require('instapromise');\nvar jsonFile = require('@exponent/json-file');\nvar path = require('path');\nvar request = require('request');\nvar simpleSpinner = require('@exponent/simple-spinner');\n\nvar api = require('./api');\nvar CommandError = require('./commands/CommandError');\nvar config = require('./config');\nvar log = require('./log');\nvar urlOpts = require('./commands/urlOpts');\n\nvar entryPointAsync = async function() {\n  // TODO: Allow configurations that point to iOS main and Android main, etc.\n  // and are checked before looking at 'main'\n  return await config.packageJsonFile.getAsync('main', 'index.js');\n}\n\nvar guessMainModulePathAsync = async function () {\n  var entryPoint = await entryPointAsync();\n  return entryPoint.replace(/\\.js$/, '');\n}\n\nfunction constructUrlFromBaseUrl(baseUrl, opts) {\n  var url = baseUrl;\n  opts = opts || {};\n  var {mainModulePath, dev, minify} = opts;\n  mainModulePath = mainModulePath || 'index.js';\n  url += '/' + encodeURIComponent(mainModulePath) + '.';\n  if (opts.includeRequire !== false) {\n    url += encodeURIComponent('includeRequire.');\n  }\n  if (opts.runModule !== false) {\n    url += encodeURIComponent('runModule.');\n  }\n  url += 'bundle';\n  url += '?dev=' + encodeURIComponent(!!dev);\n  if (minify != null) {\n    url += '&minify=' + encodeURIComponent(!!minify);\n  }\n  return url;\n}\n\nasync function constructUrlAsync(opts) {\n  if (_.isString(opts)) {\n    opts = {type: opts};\n  }\n  opts = opts || {};\n  var key = opts.type;\n  var baseUrl = await config.expInfoFile.getAsync(key + 'BaseUrl');\n  opts.mainModulePath = opts.mainModulePath || await guessMainModulePathAsync();\n  return constructUrlFromBaseUrl(baseUrl, opts);\n}\n\nasync function mainBundleUrlAsync(opts) {\n  return await constructUrlAsync(opts);\n}\n\nasync function getTestedMainBundleUrlAsync(opts) {\n  var url = await mainBundleUrlAsync(opts);\n  return await testUrlAsync(url);\n}\n\nasync function testUrlAsync(url) {\n  var response = await request.promise.get(url);\n  if (!(response.statusCode == 200)) {\n    throw new Error(\"Problem reading from URL \" + url + \"\\nstatusCode=\" + response.statusCode);\n  }\n  return url;\n}\n\nfunction expUrlFromHttpUrl(url) {\n  return ('' + url).replace(/^http(s?)/,'exp');\n}\n\nfunction sendUrlAsync(recipient, expUrl) {\n  return api.callMethodAsync('send', [recipient, expUrl]);\n}\n\nasync function httpRedirectUrlAsync(url) {\n  var baseUrl = await api.getExpHostBaseUrlAsync();\n  return baseUrl + '/--/to-exp/' + encodeURIComponent(url);\n}\n\nasync function appetizeWebSimulatorUrlAsync(url) {\n  var baseUrl = await api.getExpHostBaseUrlAsync();\n  return baseUrl + '/--/appetize?url=' + encodeURIComponent(url);\n}\n\nasync function testLoadingUrlWithLogging(httpUrl) {\n\n  log(\"Testing loading the URL...\");\n  simpleSpinner.start();\n  var err = undefined;\n  try {\n    var ok = await testUrlAsync(httpUrl);\n  } catch (e) {\n    log(e);\n    err = e;\n    throw err;\n  } finally {\n    simpleSpinner.stop();\n    console.log(5);\n    if (err) {\n      log(err);\n      throw err;\n    }\n  }\n  log(\"OK.\");\n\n}\n\nasync function urlFromEnvAsync(env) {\n  var argv = env.argv;\n  var args = argv._;\n\n  var uo = urlOpts.optsFromEnv(env, {type: 'ngrok'});\n\n  try {\n    var httpUrl = await mainBundleUrlAsync(uo);\n  } catch (e) {\n    throw CommandError('NO_URL', env, \"There doesn't seem to be a URL for this package. Try running `exp start` first.\\n\" + e.message);\n  }\n\n  var url = httpUrl;\n  if (!argv.http) {\n    url = expUrlFromHttpUrl(url);\n  }\n\n  if (argv.web) {\n    url = await appetizeWebSimulatorUrlAsync(url);\n  }\n\n  if (argv.redirect) {\n    url = await httpRedirectUrlAsync(url);\n  }\n\n  return url;\n\n}\n\n\nmodule.exports = {\n  appetizeWebSimulatorUrlAsync,\n  constructUrlFromBaseUrl,\n  expUrlFromHttpUrl,\n  getTestedMainBundleUrlAsync,\n  mainBundleUrlAsync,\n  sendUrlAsync,\n  testUrlAsync,\n  entryPointAsync,\n  guessMainModulePathAsync,\n  httpRedirectUrlAsync,\n  testLoadingUrlWithLogging,\n  urlFromEnvAsync,\n};\n"],"sourceRoot":"/source/"}