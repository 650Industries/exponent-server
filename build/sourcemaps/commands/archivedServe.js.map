{"version":3,"sources":["commands/archivedServe.js"],"names":[],"mappings":"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","file":"commands/archivedServe.js","sourcesContent":["var child_process = require('child_process');\nvar co = require('co');\nvar crayon = require('@ccheever/crayon');\nvar inquirerAsync = require('inquirer-async');\nvar instapromise = require('instapromise');\nvar ngrok = require('ngrok');\nvar path = require('path');\nvar simpleSpinner = require('@exponent/simple-spinner');\nvar stream = require('stream');\n\nvar api = require('../api');\nvar config = require('../config');\nvar log = require('../log');\nvar urlUtil = require('../urlUtil');\nvar userSettings = require('../userSettings');\n\n\nmodule.exports = {\n  name: 'serve',\n  description: \"Starts a local server to serve your app and gives you a URL to it\",\n  args: [\"[project-dir]\"],\n  options: [\n    ['--path=PATH', \"The path to the place where your package is\", '.'],\n    ['--port=PORT', \"The port to run the server on\", \"Random (9000-9999)\"],\n    ['--ngrokSubdomain=SUBDOMAIN', \"The ngrok subdomain to use\", (config.ngrok && config.ngrok.subdomain)],\n    ['--ngrokAuthToken=AUTH_TOKEN', \"The ngrok authToken to use\", (config.ngrok && config.ngrok.authToken)],\n    ['--send=EMAIL_OR_PHONE_NUMBER', \"An e-mail address or phone number to send a link to\"]\n  ],\n  help: \"Starts a local server to serve your app and gives you a URL to it\",\n  runAsync: async function (env) {\n      var argv = env.argv;\n      var args = argv._;\n\n      // If a project-dir is provided, change to that directory\n      var projectDir = args[1];\n      if (projectDir) {\n        process.chdir(projectDir);\n        log(crayon.gray(\"Using project at\", process.cwd()));\n      }\n\n      // TODO: These two functions are sort of redundant\n      var mainModulePath = await urlUtil.guessMainModulePathAsync();\n      var entryPoint = await urlUtil.entryPointAsync();\n      log(crayon.gray(\"Using mainModulePath of\", mainModulePath, \"and an entry point of\", entryPoint));\n\n      var ngrokSubdomain = argv['ngrok-subdomain'] || (config.ngrok && config.ngrok.subdomain) || undefined;\n      var ngrokAuthToken = argv['ngrok-auth-token'] || (config.ngrok && config.ngrok.authToken) || undefined;\n\n      var port = argv.port;\n      if (port == null) {\n        port = 9000 + Math.floor(Math.random() * 1000);\n      }\n\n      var urlP = ngrok.promise.connect({\n        port: port,\n        authtoken: ngrokAuthToken,\n        subdomain: ngrokSubdomain,\n      });\n\n      //var root = path.resolve(__dirname, '..', '..');\n      var root = config.absolutePath;\n      var packager = child_process.spawn(config.packagerPath, [\"--port=\" + port, \"--root=\" + root, \"--assetRoots=\" + root,], {\n        stdio: [process.stdin, 'pipe', process.stderr],\n      });\n\n      var outStream = new stream.Writable();\n      outStream.buffer = '';\n      outStream._write = function (chunk, encoding, done) {\n        outStream.buffer += chunk.toString();\n        done();\n      };\n\n      var waitingForUrl = true;\n\n      var packagerReady = new Promise((fulfill, reject) => {\n\n        var packagerBuffer = '';\n        packager.stdout.on('readable', function () {\n          var chunk;\n          while (null !== (chunk = packager.stdout.read())) {\n            packagerBuffer += chunk.toString();\n            if (packagerBuffer.match(/React packager ready\\./)) {\n              packager.stdout.pipe(outStream);\n              fulfill(packagerBuffer);\n              break;\n            }\n          }\n        });\n      });\n\n      var urlWrittenP = urlP.then((ngrokUrl) => {\n        return urlUtil.writeUrlFileAsync(ngrokUrl);\n      });\n\n      log(crayon.gray(\"The packager is starting up and building your initial bundle...\"));\n\n      var sendTo = argv.send;\n      if (sendTo === true) {\n        var settings = userSettings().readAsync();\n        sendTo = args[1] || settings.phoneNumber || settings.email || null;\n      }\n\n      var waitingForUserInput = false;\n\n      if (!sendTo) {\n        console.log(\"Enter a phone number or an e-mail address if you want to have\");\n        console.log(\"a link to view this project sent to your phone\");\n\n        waitingForUserInput = true;\n        inquirerAsync.promptAsync([{\n          type: 'input',\n          name: 'sendTo',\n          message: \"Mobile number or e-mail address (optional):\",\n        }]).then((answers) => {\n          waitingForUserInput = false;\n          if (waitingForUrl) {\n            simpleSpinner.start();\n            sendTo = answers.sendTo;\n          }\n        }, (err) => {\n          log.error(err);\n        });;\n      }\n\n      var [ngrokUrl, packagerBuffer] = yield [urlWrittenP, packagerReady];\n\n      //log(crayon.green(\"Started packager and ngrok\"));\n\n      var httpUrl = await urlUtil.getTestedMainBundleUrlAsync();\n      var expUrl = urlUtil.expUrlFromHttpUrl(httpUrl);\n\n      waitingForUrl = false;\n\n      if (waitingForUserInput) {\n        // This clears the line and hits enter, but it doens't actually\n        // cause inquirer to return answers\n        process.stdin.write(\"\\u001b[2K\\n\");\n      } else {\n        simpleSpinner.stop();\n      }\n      console.log(\"\\nVisit this URL in the Exponent app on your phone to view this project:\\n\" + crayon.green(expUrl) + \"\\n\");\n\n      log(crayon.gray(\"Packager is running on port \" + port));\n      console.log(crayon.gray(packagerBuffer));\n      console.log(crayon.gray(outStream.buffer));\n      packager.stdout.pipe(process.stdout);\n\n      if (sendTo) {\n        log(crayon.gray(\"Sending URL to\", sendTo));\n        try {\n          var result = await urlUtil.sendUrlAsync(sendTo, expUrl);\n        } catch (e) {\n          log.error(\"Failed to send link to\", sendTo);\n        }\n      }\n\n  },\n};\n"],"sourceRoot":"/source/"}