{"version":3,"sources":["commands/whoami.js"],"names":[],"mappings":";;;;;;AAAA,IAAI,MAAM,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAC;;AAEzC,IAAI,GAAG,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,IAAI,YAAY,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;AAC7C,IAAI,GAAG,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5B,IAAI,YAAY,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC;;AAE9C,SAAS,WAAW,CAAC,OAAO,EAAE;AAC5B,MAAI,GAAG,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;AAC7B,KAAG,CAAC,cAAc,GAAG,IAAI,CAAC;AAC1B,SAAO,GAAG,CAAC;CACZ;;AAED,MAAM,CAAC,OAAO,GAAG;AACf,MAAI,EAAE,QAAQ;AACd,aAAW,EAAE,+DAA+D;AAC5E,UAAQ,oBAAE,WAAgB,GAAG,EAAE;AAC7B,QAAI;AACF,UAAI,YAAY,GAAG,MAAM,YAAY,CAAC,SAAS,EAAE,CAAC;AAClD,UAAI,CAAC,YAAY,IAAI,CAAC,YAAY,CAAC,QAAQ,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE;AAC3E,cAAM,WAAW,CAAC,sBAAsB,CAAC,CAAC;OAC3C;;UAEI,QAAQ,GAAoB,YAAY,CAAxC,QAAQ;UAAE,cAAc,GAAI,YAAY,CAA9B,cAAc;;AAE7B,UAAI,MAAM,GAAG,MAAM,GAAG,CAAC,eAAe,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAR,QAAQ,EAAE,cAAc,EAAd,cAAc,EAAC,CAAC,CAAC;;AAE7E,UAAI,MAAM,CAAC,IAAI,EAAE;AACf,WAAG,CAAC,cAAc,EAAE,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAC1C,aAAK,IAAI,GAAG,IAAI,aAAY,MAAM,CAAC,IAAI,CAAC,EAAE;AACxC,iBAAO,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;SAC1C;AACD,eAAO,MAAM,CAAC,IAAI,CAAC;OACpB,MAAM;AACL,cAAM,WAAW,CAAC,yCAAyC,CAAC,CAAC;OAC9D;KACF,CAAC,OAAO,CAAC,EAAE;AACV,UAAI,CAAC,CAAC,cAAc,EAAE;AACpB,eAAO,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;AACzB,eAAO,IAAI,CAAC;OACb,MAAM;AACL,cAAM,CAAC,CAAC;OACT;KACF;GAEF,CAAA;CACF,CAAC","file":"commands/whoami.js","sourcesContent":["var crayon = require('@ccheever/crayon');\n\nvar api = require('../api');\nvar CommandError = require('./CommandError');\nvar log = require('../log');\nvar userSettings = require('../userSettings');\n\nfunction NotLoggedIn(message) {\n  var err = new Error(message);\n  err._isNotLoggedIn = true;\n  return err;\n}\n\nmodule.exports = {\n  name: 'whoami',\n  description: \"Checks with the server and then says who you are logged in as\",\n  runAsync: async function (env) {\n    try {\n      var settingsData = await userSettings.readAsync();\n      if (!settingsData || !settingsData.username || !settingsData.hashedPassword) {\n        throw NotLoggedIn(\"You're not logged in\");\n      }\n\n      var {username, hashedPassword} = settingsData;\n\n      var result = await api.callMethodAsync('whoami', {username, hashedPassword});\n\n      if (result.user) {\n        log(\"Logged in as\", result.user.username);\n        for (var key of Object.keys(result.user)) {\n          console.log(key + ':', result.user[key]);\n        }\n        return result.user;\n      } else {\n        throw NotLoggedIn(\"No such user or your password is wrong.\");\n      }\n    } catch (e) {\n      if (e._isNotLoggedIn) {\n        console.error(e.message);\n        return null;\n      } else {\n        throw e;\n      }\n    }\n\n  },\n};\n"],"sourceRoot":"/source/"}